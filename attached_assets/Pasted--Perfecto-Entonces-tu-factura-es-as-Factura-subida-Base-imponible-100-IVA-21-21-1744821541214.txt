¬°Perfecto! Entonces tu factura es as√≠:

üßæ Factura subida
	‚Ä¢	Base imponible: 100‚ÄØ‚Ç¨
	‚Ä¢	IVA (21%): +21‚ÄØ‚Ç¨
	‚Ä¢	IRPF (-15%): ‚Äì15‚ÄØ‚Ç¨
	‚Ä¢	Total factura (a pagar):
üí∞ 106‚ÄØ‚Ç¨

	Porque se calcula: 100 + 21 - 15 = 106

üí° ¬øQu√© deber√≠as guardar (y usar) en el sistema?

Supongamos que el JSON de esa transacci√≥n contiene esto:

{
  "type": "expense",
  "totalAmount": 106,
  "additionalTaxes": [
    {
      "name": "IVA",
      "rate": 21,
      "value": 21
    },
    {
      "name": "IRPF",
      "rate": 15,
      "value": -15
    }
  ]
}

‚úÖ C√°lculos correctos esperados

Campo	Valor
baseImponibleGastos	100‚ÄØ‚Ç¨
ivaSoportadoReal	21‚ÄØ‚Ç¨
netExpenses	106‚ÄØ‚Ç¨

‚ùå Si ves estos errores, algo est√° fallando:

‚ùó Error t√≠pico 1: El sistema recalcula la base:

base = totalAmount / 1.21 = 106 / 1.21 ‚âà 87.6 ‚Ç¨
iva = 106 - 87.6 = 18.4 ‚Ç¨

Esto es incorrecto, porque t√∫ ya has indicado que:
	‚Ä¢	Base: 100
	‚Ä¢	IVA: 21
	‚Ä¢	Total: 106

No hace falta (ni se debe) recalcular nada si ya lo proporcionaste.

‚ùó Error t√≠pico 2: El sistema no suma el IVA expl√≠cito al ivaSoportado

Esto ocurre si el sistema no busca en additionalTaxes un valor value para el IVA, y por defecto intenta estimarlo a partir del total.

‚úÖ Soluci√≥n clara en backend (resumen):

let baseAmount = 0;
let ivaSoportadoReal = 0;
let irpfGastos = 0;

for (const tx of transacciones) {
  if (tx.type === 'expense') {
    const total = tx.totalAmount || 0;
    let iva = 0;
    let irpf = 0;

    // Procesamos additionalTaxes
    if (Array.isArray(tx.additionalTaxes)) {
      for (const tax of tx.additionalTaxes) {
        if (tax.name === 'IVA' && tax.value != null) {
          iva = tax.value;
        }
        if (tax.name === 'IRPF' && tax.value != null) {
          irpf = tax.value;
        }
      }
    }

    // Usamos los valores expl√≠citos
    ivaSoportadoReal += iva;
    irpfGastos += irpf;

    // La base es total - iva + irpf (porque total ya tiene los dos aplicados)
    baseAmount += total - iva + irpf;
  }
}

üß™ Ejemplo con 3 facturas

Base	IVA	IRPF	Total	Base usada	IVA usado	Net Expense
100	21	-15	106	100	21	106
500	105	-75	530	500	105	530
1000	210	-150	1060	1000	210	1060

¬øQuieres que revisemos tu c√≥digo backend l√≠nea a l√≠nea para confirmar que est√° tomando correctamente esos valores? O si me ense√±as el JSON exacto de la transacci√≥n te digo qu√© interpretaci√≥n est√° haciendo mal.