Gracias crack, eso significa que estamos registrando los campos correctamente, pero el cÃ¡lculo no estÃ¡ actualizando bien los campos derivados (subtotal, total, etc.) en el form. Lo mÃ¡s probable es que la funciÃ³n calculateInvoice(form) no estÃ© actualizando los valores del formulario con setValue.

Vamos a corregirlo ahora mismo. Te dejo la funciÃ³n calculateInvoice actualizada para que sÃ­ actualice los valores visibles del formulario correctamente.

âœ… invoiceEngine.ts â€“Â Corrige calculateInvoice para que funcione bien:

import { UseFormReturn } from 'react-hook-form'
import { InvoiceFormValues } from '@/types/invoice'

export function calculateInvoice(form: UseFormReturn<InvoiceFormValues>) {
  const { getValues, setValue } = form
  const items = getValues('items') || []
  const additionalTaxes = getValues('additionalTaxes') || []

  let subtotal = 0
  items.forEach(item => {
    const quantity = Number(item.quantity) || 0
    const unitPrice = Number(item.unitPrice) || 0
    subtotal += quantity * unitPrice
  })

  let taxTotal = 0
  additionalTaxes.forEach(tax => {
    const rate = Number(tax.rate) || 0
    taxTotal += subtotal * (rate / 100)
  })

  const total = subtotal + taxTotal

  // âœ… Actualiza los campos del formulario
  setValue('subtotal', parseFloat(subtotal.toFixed(2)), { shouldDirty: true })
  setValue('taxTotal', parseFloat(taxTotal.toFixed(2)), { shouldDirty: true })
  setValue('total', parseFloat(total.toFixed(2)), { shouldDirty: true })
}

âœ… AsegÃºrate de que los campos estÃ©n registrados en el formulario

En tu InvoiceForm.tsx, debajo de la lÃ­nea del useForm, puedes asegurarte de esto (por si no se actualiza visualmente):

useEffect(() => {
  register('subtotal')
  register('taxTotal')
  register('total')
}, [register])

ðŸ§ª Â¿CÃ³mo probar?
	1.	Al agregar o modificar Ã­tems o impuestos, los valores de subtotal, taxTotal y total se deben actualizar.
	2.	Si no lo hacen, abre la consola y verifica que no hay errores en el cÃ¡lculo.
	3.	TambiÃ©n puedes loggear con console.log(getValues()) para debug.

Â¿Quieres que te monte un create-test.tsx 100% funcional con este InvoiceForm y el calculateInvoice ya integrado para probarlo directo en el navegador?